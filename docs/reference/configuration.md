# Configuration (CLI / REPL)

AbstractVision configuration is intentionally simple:

- In Python, you configure backends by instantiating backend config objects (see `docs/reference/backends.md`).
- The CLI/REPL reads `ABSTRACTVISION_*` environment variables to set defaults (`src/abstractvision/cli.py`).

See also:
- Getting started (examples): `docs/getting-started.md`
- Backends: `docs/reference/backends.md`

## CLI commands (overview)

Implemented in `src/abstractvision/cli.py`:

- `abstractvision models` — list known registry model ids
- `abstractvision tasks` — list known tasks
- `abstractvision show-model <id>` — print a model’s tasks + params
- `abstractvision repl` — interactive testing (supports `openai`, `diffusers`, `sdcpp`)
- `abstractvision t2i ...` / `abstractvision i2i ...` — one-shot commands using the **OpenAI-compatible HTTP backend**

Note:
- `abstractvision t2i` / `abstractvision i2i` always use the OpenAI-compatible backend (they do not switch based on `ABSTRACTVISION_BACKEND`).
- Use `abstractvision repl` for local backends (`diffusers`, `sdcpp`).

## REPL backend selection

Inside `abstractvision repl`:

- `/backend openai <base_url> [api_key] [model_id]`
- `/backend diffusers <model_id_or_path> [device] [torch_dtype]`
- `/backend sdcpp <diffusion_model.gguf> <vae.safetensors> <llm.gguf> [sd_cli_path]`

Run `/help` in the REPL to see the full command list (generated by `_repl_help()` in `src/abstractvision/cli.py`).

## Environment variables

All env vars below are read by the CLI/REPL state object (`_ReplState` in `src/abstractvision/cli.py`).

### Common

- `ABSTRACTVISION_BACKEND` — REPL default backend: `openai` (default), `diffusers`, or `sdcpp`
- `ABSTRACTVISION_STORE_DIR` — local artifact output directory (default: `~/.abstractvision/assets`)
- `ABSTRACTVISION_TIMEOUT_S` — HTTP timeout for OpenAI-compatible backend (default: `300`)
- `ABSTRACTVISION_CAPABILITIES_MODEL_ID` — optional capability-gating model id (must exist in the registry)

### OpenAI-compatible HTTP backend

- `ABSTRACTVISION_BASE_URL` — required for `openai` backend
- `ABSTRACTVISION_API_KEY` — optional bearer token
- `ABSTRACTVISION_MODEL_ID` — optional remote model id/name
- `ABSTRACTVISION_IMAGES_GENERATIONS_PATH` — default: `/images/generations`
- `ABSTRACTVISION_IMAGES_EDITS_PATH` — default: `/images/edits`
- `ABSTRACTVISION_TEXT_TO_VIDEO_PATH` — optional (enables `text_to_video`)
- `ABSTRACTVISION_IMAGE_TO_VIDEO_PATH` — optional (enables `image_to_video`)
- `ABSTRACTVISION_IMAGE_TO_VIDEO_MODE` — `multipart` (default) or `json_b64`

### Diffusers backend

- `ABSTRACTVISION_DIFFUSERS_DEVICE` — `auto` (default), `cpu`, `cuda`, `mps`, …
- `ABSTRACTVISION_DIFFUSERS_TORCH_DTYPE` — optional (`float16`, `bfloat16`, `float32`)
- `ABSTRACTVISION_DIFFUSERS_ALLOW_DOWNLOAD` — `1` (default) or `0` for cache-only/offline mode
- `ABSTRACTVISION_DIFFUSERS_AUTO_RETRY_FP32` — `1` (default) or `0` (MPS-only fallback behavior)

### stable-diffusion.cpp backend

- `ABSTRACTVISION_SDCPP_BIN` — `sd-cli` path/name (default: `sd-cli`)
- `ABSTRACTVISION_SDCPP_MODEL` — optional full-model path (alternative to component mode)
- `ABSTRACTVISION_SDCPP_DIFFUSION_MODEL` — GGUF diffusion model path
- `ABSTRACTVISION_SDCPP_VAE` — VAE safetensors path (required for Qwen Image GGUF)
- `ABSTRACTVISION_SDCPP_LLM` — text encoder GGUF path (required for Qwen Image GGUF)
- `ABSTRACTVISION_SDCPP_LLM_VISION` — optional vision encoder GGUF path
- `ABSTRACTVISION_SDCPP_EXTRA_ARGS` — extra `sd-cli` flags (string, split like a shell)
